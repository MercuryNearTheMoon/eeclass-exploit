import requests
import json
from bs4 import BeautifulSoup

jsonFile = open("./userdata.json","r")

userData = json.load(jsonFile)

host = "https://eeclass."+userData['school']+".edu.tw"

#Get the phpsessid

try:
    initialPage = requests.get(host+"/")
except requests.exceptions.ConnectionError:
    exit("Wrong domain name")

initialPage.encoding = "utf-8"
phpsessid=initialPage.cookies['PHPSESSID']

#Get the csrf token

initialLogin = requests.get(host+"/index/login")
initialLogin.encoding = "utf-8"
soup = BeautifulSoup(initialLogin.text,'html.parser')
divs = soup.find_all('div', class_='fs-form-control')
csrfToken = ''
for div in divs:
    input_tag = div.find('input', attrs={'type': 'hidden', 'name': 'csrf-t'})
    if input_tag:
        csrfToken = input_tag['value']

#login = requests.post(host+"/index/login")